<?php $faciocmsVersion2="2.1.0";$route=$_POST["route"]==0?"home":$_POST["route"];if(!$_SESSION["logged"]){$route="Login";}$db=getDatabaseConnection();require_once "./utils/modules.php";requireModule("versions/".$faciocmsVersion2."/utils/pagesfunctions.php");requireModule("versions/".$faciocmsVersion2."/utils/routerecognisation.php");requireModule("modules/templateconfig.php");function avatibleUpdates(){$items=0;$url="https://faciocms.com/fcms-updates/currentUpdate.json";$data=file_get_contents($url);$data_parsed=json_decode($data);$ver=$data_parsed->{'avatible'};$parsedVersion=intval(implode('',explode('.',$ver)));$thisFacioCmsVersion=intval(implode('',explode('.',$faciocmsVersion2)));if($thisFacioCmsVersion<$parsedVersion){$items++;}return $items;} ?><div id="use-as-head"><meta charset="UTF-8"><meta content="IE=edge"http-equiv="X-UA-Compatible"><meta content="width=device-width,initial-scale=1"name="viewport"><title>FacioCMS v.<?php echo $faciocmsVersion2; ?>| Admin</title><link href="versions/<?php echo $faciocmsVersion2; ?>/less/main.less"rel="stylesheet/less"type="text/css"><script src="versions/<?php echo $faciocmsVersion2; ?>/js/headtransform.js"id="head-transform-script"></script></div><div id="routeid"style="display:none"><?php echo $route; ?></div><div id="authtoken"style="display:none"><?php echo $_SESSION["authtoken"]; ?></div><div class="adminpanel"><div class="sidebar"><h1 class="cms-name">FacioCMS</h1><h3 class="cms-version"><i>v.<?php echo $faciocmsVersion; ?></i></h3><ul class="navigation"><li class="nav-item nav-item-header"><header class="nav-header">General</header></li><li class="nav-item redirect-nav-item"data-route="Pages"><a class="nav-link"href="#!"><em class="fas mr-10 fa-sitemap"></em> Pages</a></li><li class="nav-item redirect-nav-item"data-route="Users"><a class="nav-link"href="#!"><em class="fas mr-10 fa-users"></em> Users</a></li><li class="nav-item redirect-nav-item"data-route="Templates"><a class="nav-link"href="#!"><em class="fas mr-10 fa-layer-group"></em> Templates</a></li><li class="nav-item"></li><li class="nav-item nav-item-header"><header class="nav-header">Advanced</header></li><li class="nav-item redirect-nav-item"data-route="Website Settings"><a class="nav-link"href="#!"><em class="fas mr-10 fa-cogs"></em> Website Settings</a></li><li class="nav-item redirect-nav-item"data-route="Plugins"><a class="nav-link"href="#!"><em class="fas mr-10 fa-plug"></em> Plugins</a></li><li class="nav-item"></li><li class="nav-item nav-item-header"><header class="nav-header">Utils</header></li><li class="nav-item redirect-nav-item"data-route="Bin"><a class="nav-link"href="#!"><em class="fas mr-10 fa-trash"></em> Bin</a></li><li class="nav-item redirect-nav-item"data-route="Updater"><a class="nav-link"href="#!"><em class="fas mr-10 fa-download"></em> Updater <small>(<?php echo avatibleUpdates(); ?>)</small></a></li><li class="nav-item"></li><li class="nav-item nav-item-header"><header class="nav-header">User</header></li><li class="nav-item redirect-nav-item"data-route="Profile"><a class="nav-link"href="#!"><em class="fas mr-10 fa-user"></em> Profile</a></li><li class="nav-item redirect-nav-item"><a class="nav-link"href="logout.php"target="_blank"><em class="fas mr-10 fa-sign-out-alt"></em> Logout</a></li></ul></div><div class="center-block"><h1 class="editor-name"><?php echo isPageEditRoute($route)?'Page editor':$route; ?></h1><?php if($route=="Pages"): ?><div class="editor-pages-top"><h2>Active Pages</h2><button id="add-global-page"><em class="fas fa-plus-circle"></em> Add page</button></div><div class="active-pages-container"><?php $query="SELECT * FROM pages WHERE deleted = 0 AND parentid = -1";if($res=$db->query($query)){if($res->num_rows>0){while($row=$res->fetch_assoc()){$dropdownuuid=random_int(-(2 ** 31),2 ** 31-1);echo "<div class='page-row'>\n                                    <div class='page-row-top'>\n                                        <div class='page-row-left'>\n                                            <header class='page-name'>".$row['name']."</header>\n                                            <button class='roll-dropdown-button ".(countOfSubpages($row["id"])==0?'disabled__dropdown':'')."' data-dropdown-id='".$dropdownuuid."'> <em class='fas ".(countOfSubpages($row["id"])==0?'gray_icon__dropdown':'')." fa-chevron-down subchilds-navigation-down'></em> </button>\n                                        </div>\n                                        <div class='page-row-right'>\n                                            <button class='btn-edit-page' data-pageid='".$row['id']."'><em class='fas fa-pen'></em></button>\n                                            <button class='btn-remove-page' data-pageid='".$row['id']."'><em class='fas fa-trash'></em></button>\n                                            <button class='btn-add-subpage' data-pageid='".$row['id']."'><em class='fas fa-plus'></em></button>\n                                        </div>\n                                    </div>\n                                    <div class='subpages-container-cx00-dropdown' data-dropdownid='".$dropdownuuid."'>\n                                        ".getAllSubpages($row['id'],1)."\n                                    </div>\n                                </div>";}}echo "<p class='page-rows-results'>Found ".countAllPages()." pages</p>";} ?></div><?php elseif(isPageEditRoute($route)): ?><div id="pageeditor"><form action="versions/<?php echo $faciocmsVersion2; ?>/api/save.php"method="POST"target="_blank"><?php $page="";$pageid=getPageEditId($route);$query="SELECT * FROM pages WHERE id = '$pageid' AND deleted = 0";$page=[];if($r=$db->query($query)){if($r->num_rows>0){while($row=$r->fetch_assoc()){$page=$row;}}else{echo "<h1>404. Page not found</h1>";}} ?><h2>Page</h2><br><input name="authtoken"value="<?php echo $_SESSION["authtoken"]; ?>"type="hidden"> <input name="pageid"value="<?php echo getPageEditId($route); ?>"type="hidden"> <input name="pageroute"id="pageroute_name"value="<?php echo $route; ?>"type="hidden"><div class="input-group"><label class="form-label"for="pagename">Name</label> <input name="name"id="pagename"class="form-input"value="<?php echo $page["name"]; ?>"></div><div class="input-group"><label class="form-label"for="pagecontent">Content</label><div class="text-editor-tools"><button class="btn-text-editor-tool"type="button"data-command="bold"><em class="fas fa-bold"></em></button> <button class="btn-text-editor-tool"type="button"data-command="italic"><em class="fas fa-italic"></em></button> <button class="btn-text-editor-tool"type="button"data-command="underline"><em class="fas fa-underline"></em></button> <button class="btn-text-editor-tool"type="button"data-command="justifyLeft"><em class="fas fa-align-left"></em></button> <button class="btn-text-editor-tool"type="button"data-command="justifyCenter"><em class="fas fa-align-center"></em></button> <button class="btn-text-editor-tool"type="button"data-command="justifyRight"><em class="fas fa-align-right"></em></button> <button class="btn-text-editor-tool"type="button"data-command="justifyFull"><em class="fas fa-align-justify"></em></button> <button class="btn-text-editor-tool"type="button"data-command="undo"><em class="fas fa-undo-alt"></em></button> <button class="btn-text-editor-tool"type="button"data-command="redo"><em class="fas fa-redo-alt"></em></button></div><div class="text-editor"contenteditable="true"text-editor-for="pagecontent_send"><?php echo $page["content"]; ?></div><input name="content"id="pagecontent_send"class="form-input"value="<?php echo htmlspecialchars($page["content"]); ?>"type="hidden"></div><div class="input-group"><label class="form-label"for="templatename">Template</label> <select class="form-input form-option"id="templatename"name="template"><?php foreach(scandir("../tpls/")as $file){if($file=="."||$file==".."||(explode(".",$file)[count(explode(".",$file))-1]!="tplc"))continue;$f=fopen("../tpls/$file","r");$cfg=readConfig(fread($f,filesize("../tpls/$file")));echo intval(implode("",explode(".",$faciocmsVersion2)));if(intval(implode("",explode(".",$cfg[5])))<=intval(implode("",explode(".",$faciocmsVersion2)))){$tr="<option value='$file' ".(($file==$page["template"])?'selected':'').">$cfg[0] <small>(v. $cfg[1])</small></option>";echo $tr;}else{if(implode('',explode(' ',$cfg[7]))=='false'){$tr="<option disabled>$cfg[0] <small><strong>(incompatible): requires at least fcms v.$cfg[5]</strong></small></option>";echo $tr;}else{$tr="<option value='$file' ".(($file==$page["template"])?'selected':'').">$cfg[0] <small>(v. $cfg[1])</small></option>";echo $tr;}}fclose($f);} ?></select></div><div class="input-group"><label class="form-label"for="page-link">Link</label> <input name="pagelink"id="page-link"class="form-input"value="<?php echo $page["link"]; ?>"></div><div class="input-group"><label class="form-label"for="pageisdefault">Home Page</label> <input name="isdefault"id="pageisdefault"class="form-checkbox"type="checkbox"<?php echo $page["isDefault"]==1?'checked':'' ?>></div><button class="btn-save">Save</button> <button class="btn-removepage"type="button"data-pageid="<?php echo $page["id"]; ?>">Delete</button></form><form action="versions/<?php echo $faciocmsVersion2; ?>/api/addonssave.php"method="POST"target="_blank"><br><h2>Addons <button class="add-addon-key"type="button"><em class="fas fa-plus"></em></button></h2><br><input name="apiauthtoken"id="authtoken__api"type="hidden"> <input name="pageid"id="pageid_api"value="<?php echo $pageid; ?>"type="hidden"><div class="addons-container-div"><?php $pageid=getPageEditId($route);$query="SELECT * FROM addons WHERE pageid = '$pageid'";if($res=$db->query($query)){if($res->num_rows>0){while($row=$res->fetch_assoc()): ?><div class="row-page-addon"><div class="row-page-addon-left"><?php echo $row["name"]; ?></div><div class="row-page-addon-right"><input name="<?php echo $row["name"]; ?>"value="<?php echo $row["value"]; ?>"class="row-page-addon-input"> <a class="link-remove-addon"href=""target="_blank"data-addonid="<?php echo $row["id"]; ?>"><em class="fas fa-minus-circle"></em></a></div></div><?php endwhile;}else{echo "<strong>Page contains 0 addons</strong>";}} ?></div><br><button class="btn-save"id="saveaddonsbutton">Save</button></form></div><?php elseif($route=="Users"): ?><div class="container-users"><div class="topmenu-user"><h3>Users list</h3><div class="topmenu-users-right"><button class="add-new-user-button"><em class="fas fa-plus-circle"></em> New User</button></div></div><div class="container-users-box"><?php $query="SELECT * FROM users ORDER BY username ASC";if($res=$db->query($query)){if($res->num_rows>0){while($row=$res->fetch_assoc()): ?><div class="user-row-user-list"><div class="user-row-nickname-container"><header class="user-row-user-name"><?php echo $row["username"]; ?></header></div><div class="user-row-right-section"><a class="remove-user-button-as-link"href="#unformatted_link"target="_blank"data-userid="<?php echo $row["id"]; ?>"><em class="fas fa-minus-circle"></em></a></div></div><?php endwhile;}else{echo "FacioCMS could not find any users in database. Please contact with admin.";}} ?></div></div><?php elseif($route=="Templates"): ?><div class="templates-container"><?php $files=scandir("../tpls");$filesWithContens=[];foreach($files as $key=>$file){if($file!=".."&&$file!="."&&(explode(".",$file)[count(explode(".",$file))-1]=="tplc")){$fileo=fopen("../tpls/$file","r");array_push($filesWithContens,fread($fileo,filesize("../tpls/$file")));fclose($fileo);}}foreach($filesWithContens as $file): ?><?php $cfg=readConfig($file); ?><div class="template-box"title="Author:<?php echo $cfg[2]; ?>"><header class="template-name"><?php echo $cfg[0]; ?><small>v.<?php echo $cfg[1]; ?></small></header><p><?php echo $cfg[3]; ?></p></div><?php endforeach; ?></div><?php elseif($route=="Plugins"): ?><div class="plugins-container"><?php print_r($pluginsInstances); ?><?php foreach($_SESSION["loadedPlugins"]as $pluginInstance): ?><div class="plugin-box"><header class="plugin-name"><?php echo $pluginInstance["name"]; ?></header><span class="active plugin-status">Active</span></div><?php endforeach; ?></div><?php elseif($route=="Website Settings"): ?><div class="seo-container"><?php $data=[];$query="SELECT * FROM seo";if($res=$db->query($query)){while($row=$res->fetch_assoc()){$data=$row;}} ?><form action="versions/<?php echo $faciocmsVersion2; ?>/api/savesettings.php"method="post"class="form-settings"target="_blank"><input name="apiauth"value="<?php echo $_SESSION["authtoken"]; ?>"type="hidden"><div class="input-group"><label class="form-label"for="ws-author">Website Author (*)</label> <input name="ws-author"id="ws-author"class="form-input"value="<?php echo $data["author"]; ?>"></div><div class="input-group"><label class="form-label"for="ws-desc">Website Description (*)</label> <input name="ws-desc"id="ws-desc"class="form-input"value="<?php echo $data["description"]; ?>"></div><div class="input-group"><label class="form-label"for="og-title">OpenGraph Title (*)</label> <input name="og-title"id="og-title"class="form-input"value="<?php echo $data["ogtitle"]; ?>"></div><div class="input-group"><label class="form-label"for="og-type">OpenGraph Type (*)</label> <input name="og-type"id="og-type"class="form-input"value="<?php echo $data["ogtype"]; ?>"></div><div class="input-group"><label class="form-label"for="og-image-url">OpenGraph Image Url (*)</label> <input name="og-imageurl"id="og-image-url"class="form-input"value="<?php echo $data["ogimage"]; ?>"></div><div class="input-group"><label class="form-label"for="og-url">OpenGraph URL (*)</label> <input name="og-url"id="og-url"class="form-input"value="<?php echo $data["ogurl"]; ?>"></div><div class="input-group"><label class="form-label"for="og-locale">OpenGraph Locale (*)</label> <input name="og-locale"id="og-locale"class="form-input"value="<?php echo $data["oglocale"]; ?>"></div><div class="input-group"><label class="form-label"for="keyword-add-input">Website Keywords (*)</label> <input id="keyword-add-input"class="form-input"><div class="group-of-keywords"><?php $keywords=explode(",",$data["keywords"]);foreach($keywords as $keyword): ?><div class="keyword-item"onclick="this.remove(),window.faciocms.keywordsToInput()"><?php echo $keyword; ?></div><?php endforeach; ?></div></div><input name="ws-keywords"id="keywords-meta-input"type="hidden"> <button class="btn-save">Save</button><p class="meta-description-settings">(*) - meta tag</p></form></div><?php elseif($route=="Login"): ?>Sorry, you aren't logged to FacioCMS. Please sign in below.<div class="login-form-outer"><form action="auth.php"method="POST"class="login-form-inner"><h3>Sign In</h3><label class="login-form-label"for="username">Username</label> <input name="username"id="username"class="login-form-input"> <label class="login-form-label"for="password">Password</label> <input name="password"id="password"class="login-form-input"type="password"> <button class="btn-login">Login</button><?php echo@$_SESSION["loginerror"];$_SESSION["loginerror"]=""; ?></form></div><?php elseif($route=="Updater"): ?><?php $url="https://faciocms.com/fcms-updates/currentUpdate.json";$data=file_get_contents($url);$data_parsed=json_decode($data);$ver=$data_parsed->{'avatible'};$parsedVersion=intval(implode('',explode('.',$ver)));$thisFacioCmsVersion=intval(implode('',explode('.',$faciocmsVersion2)));if($parsedVersion>$thisFacioCmsVersion){echo"<h2 class='update-info'>Update is avatible (v.$ver)</h2> <button class='btn-start-updating'>Start Update!</button>";}else{echo "<h2 class='update-info'>Your FacioCMS is updated to newest version!</h2>";} ?><?php elseif($route=="Profile"): ?><form action="versions/<?php echo $faciocmsVersion2; ?>/api/saveuserprofile.php"method="POST"class="profile-configurate"><input name="apiauth"value="<?php echo $_SESSION["authtoken"]; ?>"type="hidden"> <input name="passwordold"id="oldpassword__user"type="hidden"> <label class="form-label"for="username___form_user_info">Username</label> <input name="username"id="username___form_user_info"class="form-input"value="<?php echo $_SESSION["username"]; ?>"> <button class="btn-save save-user-info"type="button">Save</button></form><?php elseif($route=="Bin"): ?><h2>Deleted pages:</h2><br><div class="deleted-pages-container"><?php $query="SELECT * FROM pages WHERE deleted = 1";if($res=$db->query($query)){if($res->num_rows>0){while($row=$res->fetch_assoc()): ?><div class="row-deleted-page"><header><?php echo $row["name"] ?></header><div class="btn-group-at-right"><button class="btn-delete-pernamently"data-pageid="<?php echo $row["id"]; ?>"title="Delete pernamently"><em class="fas fa-trash"></em></button> <button class="btn-restore-page"data-pageid="<?php echo $row["id"]; ?>"title="Restore"><em class="fas fa-check"></em></button></div></div><?php endwhile;}else{echo "You don't have any deleted pages";}} ?></div><?php endif  ?></div></div><div id="javascript-import-section"><script src="https://cdn.jsdelivr.net/npm/less@4.1.1"></script><script src="versions/<?php echo $faciocmsVersion2; ?>/js/main.js"></script><script src="https://kit.fontawesome.com/f6412110a3.js"crossorigin="anonymous"></script></div><div id="prompt-section"></div><?php requireModule("versions/".$faciocmsVersion2."/pluginloader/pluginloader.php"); ?><div class="context-menu-new"><ul class="context-menu-navigator"><li class="context-menu-top"><button class="context-menu-button"onclick="window.location.reload()"><em class="fas fa-redo-alt"></em></button> <button class="context-menu-button"onclick='document.execCommand("copy")'><em class="fas fa-copy"></em></button></li><li><a class="context-menu-navigator-link reload-at-click"href="#!"onclick='RouteChange("Pages")'><em class="fas mr-10 fa-sitemap"></em> Pages</a></li><li><a class="context-menu-navigator-link reload-at-click"href="#!"onclick='RouteChange("Users")'><em class="fas mr-10 fa-users"></em> Users</a></li><li><a class="context-menu-navigator-link reload-at-click"href="#!"onclick='RouteChange("Website Settings")'><em class="fas mr-10 fa-cogs"></em> Website Settings</a></li><li><a class="context-menu-navigator-link reload-at-click"href="#!"onclick='RouteChange("Bin")'><em class="fas mr-10 fa-trash"></em> Bin</a></li><li><a class="context-menu-navigator-link reload-at-click"href="#!"onclick='RouteChange("Updater")'><em class="fas mr-10 fa-download"></em> Updater</a></li><li><a class="context-menu-navigator-link reload-at-click"href="logout.php"onclick="setTimeout(() => window.location.reload(), 20)"target="_blank"><em class="fas mr-10 fa-sign-out-alt"></em> Sign Out</a></li><li class="bottom-context-menu">FacioCMS</li></ul></div>
